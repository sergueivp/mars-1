<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MARS-1 Career Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
  <style>
    :root {
      --bg: #0a0f1e;
      --panel: #141c2e;
      --panel-2: #111a2b;
      --border: #1e2d4a;
      --accent: #e8560a;
      --accent-2: #0ea5e9;
      --text: #ffffff;
      --muted: #8899aa;
      --danger: #ef4444;
      --warn: #f59e0b;
      --ok: #22c55e;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      --transition: 200ms ease;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      font-family: "Inter", sans-serif;
      background: radial-gradient(circle at 20% -10%, rgba(14, 165, 233, 0.18), transparent 40%),
                  radial-gradient(circle at 80% 0%, rgba(232, 86, 10, 0.2), transparent 34%),
                  var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 28px 28px;
      pointer-events: none;
      z-index: -1;
    }

    .hidden {
      display: none !important;
    }

    .app-shell {
      max-width: 1320px;
      margin: 0 auto;
      padding: 22px;
      transition: opacity var(--transition);
    }

    .timer-chip {
      position: fixed;
      top: 18px;
      right: 18px;
      z-index: 120;
      background: rgba(20, 28, 46, 0.88);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 700;
      letter-spacing: 0.04em;
      box-shadow: var(--shadow);
      transition: var(--transition);
      backdrop-filter: blur(8px);
      min-width: 96px;
      text-align: center;
    }

    .timer-chip.warn {
      color: var(--warn);
      border-color: rgba(245, 158, 11, 0.6);
      box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.18), var(--shadow);
    }

    .timer-chip.danger {
      color: #ff9b9b;
      border-color: rgba(239, 68, 68, 0.65);
      animation: pulse 1.25s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.035); }
    }

    .expired-overlay {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(10, 15, 30, 0.95);
      color: var(--text);
      border: 1px solid rgba(245, 158, 11, 0.45);
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 0.9rem;
      z-index: 130;
      box-shadow: var(--shadow);
      max-width: 560px;
      width: calc(100vw - 24px);
      text-align: center;
    }

    .progress-stepper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .step-pill {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px;
      font-size: 0.78rem;
      color: var(--muted);
      background: #0f1728;
      white-space: nowrap;
      transition: var(--transition);
      text-align: center;
    }

    .step-pill.active {
      border-color: rgba(14, 165, 233, 0.7);
      color: var(--text);
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.18), rgba(232, 86, 10, 0.14));
    }

    .step-pill.done {
      border-color: rgba(232, 86, 10, 0.55);
      color: #ffd5c2;
    }

    .layout {
      display: grid;
      grid-template-columns: 230px minmax(0, 1fr) 300px;
      gap: 16px;
      align-items: start;
    }

    .phase-rail,
    .right-rail,
    .sidebar,
    .live-sidebar,
    .panel {
      background: rgba(20, 28, 46, 0.86);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }

    .phase-rail {
      position: sticky;
      top: 84px;
      padding: 12px;
    }

    .phase-rail h3 {
      margin: 0 0 10px;
      font-size: 0.88rem;
      color: #d9e6f2;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .right-rail {
      position: sticky;
      top: 84px;
      padding: 12px;
      display: grid;
      gap: 12px;
      background: rgba(12, 18, 33, 0.85);
    }

    .live-sidebar {
      padding: 14px;
      min-height: 220px;
    }

    .live-sidebar h3 {
      margin: 0 0 8px;
      color: #d9ecfb;
      font-size: 0.9rem;
      letter-spacing: 0.05em;
    }

    .sidebar {
      padding: 16px;
    }

    .sidebar h3 {
      margin: 0 0 8px;
      font-size: 0.95rem;
      color: #d9e6f2;
      letter-spacing: 0.04em;
    }

    .completion {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent-2);
      margin-bottom: 10px;
    }

    .bar {
      height: 10px;
      border-radius: 999px;
      background: #0d1424;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .bar > span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 300ms ease;
    }

    .sidebar p {
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 0.88rem;
      line-height: 1.45;
    }

    .mars-card {
      border: 1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(145deg, rgba(16, 27, 45, 0.9), rgba(8, 14, 27, 0.94));
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .mars-orbit-wrap {
      width: 98px;
      height: 98px;
      position: relative;
      display: grid;
      place-items: center;
      flex-shrink: 0;
    }

    .mars-logo {
      width: 66px;
      height: 66px;
      border-radius: 50%;
      position: relative;
      background-image: url("data:image/jpeg;base64,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");
      background-size: cover;
      background-position: center;
      animation: spin 14s linear infinite;
      box-shadow: 0 0 18px rgba(232, 86, 10, 0.34);
      overflow: hidden;
      border: 1px solid rgba(255, 162, 118, 0.45);
      z-index: 1;
    }

    .mars-logo::before {
      content: "";
      position: absolute;
      inset: -7px;
      border-radius: 50%;
      border: 2px solid rgba(14, 165, 233, 0.46);
      border-left-color: transparent;
      border-right-color: transparent;
      transform: rotate(24deg);
      z-index: 2;
      pointer-events: none;
    }

    .mars-logo::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 22%, rgba(255, 255, 255, 0.34), transparent 36%),
                  radial-gradient(circle at 78% 70%, rgba(0, 0, 0, 0.46), rgba(0, 0, 0, 0.18) 48%, transparent 76%);
      z-index: 1;
      pointer-events: none;
    }

    .mars-satellite {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 0;
      height: 0;
      pointer-events: none;
      transform: translate(0, 0);
      z-index: 3;
    }

    .mars-satellite .satellite-core {
      position: absolute;
      left: 0;
      top: 0;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #9fe5ff;
      border: 1px solid rgba(14, 165, 233, 0.85);
      box-shadow: 0 0 10px rgba(14, 165, 233, 0.95), 0 0 22px rgba(14, 165, 233, 0.55);
      transform: translate(-50%, -50%);
      animation: satelliteBlink 1.2s ease-in-out infinite;
    }

    .mars-satellite .satellite-trail {
      position: absolute;
      left: -24px;
      top: -1px;
      width: 24px;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(14, 165, 233, 0), rgba(14, 165, 233, 0.7));
      filter: blur(0.5px);
      opacity: 0.9;
      transform-origin: right center;
      animation: satelliteTrailFade 1.2s ease-in-out infinite;
    }

    @keyframes satelliteBlink {
      0%, 100% { opacity: 0.45; transform: translate(-50%, -50%) scale(0.92); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.12); }
    }

    @keyframes satelliteTrailFade {
      0%, 100% { opacity: 0.35; width: 18px; left: -18px; }
      50% { opacity: 0.9; width: 28px; left: -28px; }
    }

    .mars-label {
      font-size: 0.86rem;
      color: #d6ecff;
      line-height: 1.35;
    }

    .mars-label strong {
      display: block;
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      color: #ffab74;
    }

    .panel {
      min-height: 70vh;
      padding: 22px;
      position: relative;
      overflow: hidden;
    }

    .section {
      display: none;
      animation: fadeSlide 230ms ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeSlide {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .heading {
      margin-bottom: 16px;
    }

    .eyebrow {
      margin: 0 0 6px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--accent-2);
      font-weight: 600;
    }

    h1, h2, h3 {
      margin: 0;
    }

    h2 {
      font-size: 1.55rem;
      line-height: 1.2;
    }

    .subtle {
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.5;
    }

    .form-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .field.full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.86rem;
      color: #dbe7f2;
      font-weight: 600;
    }

    .required::after {
      content: " *";
      color: #ff7f7f;
    }

    input,
    textarea,
    select,
    button {
      font-family: inherit;
    }

    input,
    textarea,
    select {
      width: 100%;
      background: #0e1729;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 11px;
      padding: 11px 12px;
      font-size: 0.95rem;
      outline: none;
      transition: var(--transition);
    }

    textarea {
      resize: vertical;
      min-height: 110px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: rgba(14, 165, 233, 0.65);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.14);
    }

    .error {
      border-color: rgba(239, 68, 68, 0.78) !important;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.14) !important;
    }

    .error-msg {
      color: #ff9b9b;
      font-size: 0.78rem;
      display: none;
    }

    .field.invalid .error-msg {
      display: block;
    }

    .nav {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border: 1px solid var(--border);
      background: #0f1a2f;
      color: var(--text);
      border-radius: 11px;
      padding: 11px 15px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.92rem;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(14, 165, 233, 0.5);
    }

    .btn.primary {
      background: linear-gradient(135deg, #ed641f, #e8560a);
      border-color: rgba(255, 156, 112, 0.4);
      box-shadow: 0 8px 22px rgba(232, 86, 10, 0.3);
    }

    .btn.outline {
      background: transparent;
      border-color: rgba(14, 165, 233, 0.5);
      color: #d7eeff;
    }

    .btn.small {
      padding: 8px 10px;
      border-radius: 9px;
      font-size: 0.82rem;
    }

    .btn.shake {
      animation: submitShake 400ms ease;
    }

    @keyframes submitShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    .submission-alert {
      background: #3a0a0a;
      border: 1px solid #cc2200;
      color: #ff6b6b;
      border-radius: 12px;
      padding: 12px;
      margin: 10px 0 14px;
      font-size: 13px;
      line-height: 1.45;
      display: none;
      opacity: 0;
      transition: opacity 200ms ease;
    }

    .submission-alert.show {
      display: block;
      opacity: 1;
    }

    .submission-alert .line {
      margin-bottom: 4px;
    }

    .submission-alert .line:last-of-type {
      margin-bottom: 10px;
    }

    .submission-alert .review-fix {
      border: 1px solid rgba(255, 141, 141, 0.5);
      background: rgba(255, 107, 107, 0.12);
      color: #ffd0d0;
      border-radius: 9px;
      padding: 7px 10px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }

    .clear-data-btn {
      position: fixed;
      top: 18px;
      right: 132px;
      z-index: 115;
      border: 1px solid rgba(239, 68, 68, 0.55);
      background: rgba(58, 10, 10, 0.9);
      color: #ffb2b2;
      border-radius: 999px;
      padding: 9px 13px;
      font-size: 0.78rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: var(--transition);
    }

    .clear-data-btn:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 107, 107, 0.75);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(14, 165, 233, 0.12);
      border: 1px solid rgba(14, 165, 233, 0.45);
      color: #bce9ff;
      font-weight: 700;
      width: max-content;
      box-shadow: 0 0 28px rgba(14, 165, 233, 0.2);
    }

    .photo-upload-wrap {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    .photo-preview {
      width: 90px;
      height: 90px;
      border-radius: 999px;
      border: 2px solid var(--border);
      background: #0d1627;
      display: grid;
      place-items: center;
      overflow: hidden;
      color: var(--muted);
      font-size: 0.8rem;
    }

    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .helper {
      margin-top: 10px;
      padding: 12px;
      border-radius: 11px;
      border: 1px dashed rgba(136, 153, 170, 0.4);
      background: rgba(10, 15, 30, 0.55);
    }

    .word-counter {
      margin-top: 7px;
      font-size: 0.82rem;
      color: var(--muted);
      text-align: right;
    }

    .word-counter.over {
      color: #ff8e8e;
      font-weight: 600;
    }

    details summary {
      cursor: pointer;
      list-style: none;
      font-weight: 700;
      color: #d9ecfb;
      font-size: 0.85rem;
      letter-spacing: 0.04em;
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    details[open] {
      margin-top: 8px;
    }

    .entry-card {
      background: #0f1728;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }

    .entry-remove {
      position: absolute;
      top: 10px;
      right: 10px;
      border: 0;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: rgba(239, 68, 68, 0.14);
      color: #ff9b9b;
      cursor: pointer;
    }

    .tag-input-wrap {
      border: 1px solid var(--border);
      background: #0b1424;
      border-radius: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px;
      min-height: 44px;
    }

    .tag {
      background: rgba(14, 165, 233, 0.14);
      border: 1px solid rgba(14, 165, 233, 0.38);
      color: #cbeeff;
      padding: 6px 9px;
      border-radius: 999px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tag .x {
      cursor: pointer;
      color: #ffb9b9;
      font-weight: 700;
    }

    .tag-input-wrap input {
      border: 0;
      background: transparent;
      min-width: 120px;
      flex: 1;
      padding: 4px;
      box-shadow: none;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .chip {
      border: 1px solid var(--border);
      background: #0f1728;
      color: #d2deeb;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 0.82rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .chip:hover {
      border-color: rgba(14, 165, 233, 0.6);
    }

    .chip.selected {
      background: rgba(232, 86, 10, 0.19);
      border-color: rgba(232, 86, 10, 0.6);
      color: #ffd5c1;
    }

    .skills-selected {
      margin-top: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #0d1525;
    }

    .skills-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 34px;
    }

    .skills-list .tag {
      cursor: grab;
      user-select: none;
    }

    .lang-row {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr 120px;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .lang-meter {
      height: 9px;
      border-radius: 999px;
      background: #15233b;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .lang-meter span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #0ea5e9, #22c55e);
      transition: width 300ms ease;
    }

    .counter {
      font-size: 0.86rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .soft-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .soft-option {
      border: 1px solid var(--border);
      background: #0f1728;
      border-radius: 10px;
      padding: 9px;
      cursor: pointer;
      color: #d8e6f4;
      font-size: 0.86rem;
      transition: var(--transition);
    }

    .soft-option.active {
      background: rgba(14, 165, 233, 0.18);
      border-color: rgba(14, 165, 233, 0.65);
    }

    .preview-shell {
      display: block;
    }

    .cv-card {
      background: #f5f8fc;
      color: #111827;
      border-radius: 14px;
      padding: 24px;
      min-height: 420px;
      position: relative;
      border: 1px solid #d9e4ef;
      width: 100%;
    }

    .cv-watermark {
      position: absolute;
      right: 16px;
      bottom: 14px;
      font-size: 0.74rem;
      color: #b7c7d8;
      letter-spacing: 0.08em;
      font-weight: 700;
    }

    .cv-header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      border-bottom: 1px solid #d5e0ea;
      padding-bottom: 12px;
      margin-bottom: 12px;
    }

    .cv-name {
      font-size: 1.55rem;
      font-weight: 800;
      margin: 0 0 4px;
    }

    .cv-small {
      color: #334155;
      font-size: 0.88rem;
      line-height: 1.45;
    }

    .cv-sec {
      margin-bottom: 12px;
    }

    .cv-sec h4 {
      margin: 0 0 6px;
      font-size: 0.88rem;
      letter-spacing: 0.08em;
      color: #1e3a5f;
    }

    .cv-item {
      margin-bottom: 8px;
      font-size: 0.88rem;
      line-height: 1.45;
      color: #1f2937;
    }

    .cv-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .cv-tag {
      border: 1px solid #c5d4e3;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 0.78rem;
      color: #1f3a57;
      background: #eef4fa;
    }

    .preview-side {
      background: rgba(10, 15, 30, 0.44);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
    }

    .preview-mini {
      background: #f7fbff;
      color: #1f2937;
      border-radius: 10px;
      padding: 12px;
      border: 1px solid #dce8f3;
      font-size: 0.84rem;
    }

    .preview-mini h5 {
      margin: 0 0 8px;
      font-size: 0.88rem;
      color: #1d4f7a;
    }

    .mission-intro {
      min-height: calc(100vh - 72px);
      display: grid;
      place-items: center;
      text-align: center;
      padding: 24px;
    }

    .intro-card {
      max-width: 860px;
      width: 100%;
      background: rgba(20, 28, 46, 0.74);
      border: 1px solid rgba(30, 45, 74, 0.8);
      border-radius: 20px;
      padding: 36px 24px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      position: relative;
      overflow: hidden;
    }

    .intro-card::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      border: 1px solid rgba(232, 86, 10, 0.25);
      pointer-events: none;
    }

    .logo {
      font-size: 1.2rem;
      color: #ff944d;
      letter-spacing: 0.2em;
      font-weight: 800;
      margin-bottom: 14px;
    }

    .intro-title {
      font-size: clamp(1.5rem, 4vw, 2.45rem);
      margin: 0;
      line-height: 1.16;
    }

    .intro-sub {
      color: #95cdeb;
      margin-top: 8px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    .typewriter {
      margin: 20px auto;
      max-width: 720px;
      color: #d0deec;
      line-height: 1.72;
      min-height: 132px;
      text-align: left;
      border-left: 2px solid rgba(14, 165, 233, 0.45);
      padding-left: 14px;
      font-size: 1rem;
      white-space: pre-wrap;
    }

    .intro-btn-wrap {
      margin-top: 18px;
    }

    .btn.launch {
      font-size: 1.05rem;
      padding: 13px 24px;
      animation: glow 1.6s infinite;
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(232,86,10,0.45); }
      50% { box-shadow: 0 0 0 10px rgba(232,86,10,0); }
    }

    .muted-tiny {
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.82rem;
    }

    .status-cycle {
      min-height: 26px;
      margin-top: 14px;
      color: #bbdcf3;
      font-size: 0.96rem;
      opacity: 0;
      transition: opacity 260ms ease;
    }

    .status-cycle.show {
      opacity: 1;
    }

    .submission-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, #121f37, #070b16 60%);
      z-index: 210;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .submission-overlay.active {
      display: flex;
    }

    .submission-card {
      width: min(900px, 100%);
      background: rgba(11, 17, 32, 0.92);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      text-align: center;
    }

    .upload-bar {
      height: 14px;
      background: #0f192d;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 14px;
    }

    .upload-bar > span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 120ms linear;
    }

    .planet {
      width: 150px;
      height: 150px;
      margin: 12px auto;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #ffb07e, #e8560a 45%, #6b2e13 75%);
      position: relative;
      animation: spin 6s linear infinite;
      box-shadow: 0 0 24px rgba(232, 86, 10, 0.35);
    }

    .planet::before,
    .planet::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      background: rgba(130, 53, 21, 0.32);
    }

    .planet::before {
      width: 85px;
      height: 20px;
      top: 36px;
      left: 36px;
      transform: rotate(-15deg);
    }

    .planet::after {
      width: 100px;
      height: 24px;
      top: 86px;
      left: 20px;
      transform: rotate(12deg);
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .assess-grid {
      text-align: left;
      max-width: 700px;
      margin: 0 auto;
    }

    .assess-row {
      margin-bottom: 12px;
    }

    .assess-row .label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      color: #dcecfb;
      font-size: 0.83rem;
      letter-spacing: 0.05em;
    }

    .assess-row .meter {
      height: 10px;
      border-radius: 999px;
      background: #111a2e;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .assess-row .meter span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #0ea5e9, #22c55e);
      transition: width 1.5s ease;
    }

    .terminal {
      text-align: left;
      background: #02060f;
      border: 1px solid rgba(34, 197, 94, 0.35);
      border-radius: 14px;
      padding: 16px;
      color: #57e389;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      white-space: pre-wrap;
      min-height: 360px;
      max-height: 62vh;
      overflow: auto;
      font-size: 0.92rem;
      line-height: 1.45;
    }

    .final-actions {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      opacity: 0;
      transition: opacity 350ms ease;
      pointer-events: none;
    }

    .final-actions.show {
      opacity: 1;
      pointer-events: auto;
    }

    .split-input {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin: 8px 0;
    }

    .small-caption {
      font-size: 0.77rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .bullet-hint {
      color: #8899aa;
      font-style: italic;
    }

    .intro-only {
      display: none;
    }

    .intro-only.active {
      display: block;
    }

    .main-app {
      display: none;
    }

    .main-app.active {
      display: block;
    }

    .mini-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 7px;
    }

    .mini-list li {
      color: #283e58;
      border-bottom: 1px dashed #d7e3ee;
      padding-bottom: 4px;
      font-size: 0.82rem;
    }

    .tiny-badge {
      display: inline-block;
      background: #eef3f8;
      border: 1px solid #d4e2ef;
      border-radius: 999px;
      padding: 3px 8px;
      color: #26435f;
      font-size: 0.72rem;
      font-weight: 700;
      margin-right: 6px;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .phase-rail,
      .right-rail,
      .sidebar {
        position: relative;
        top: 0;
      }

      .preview-shell {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app-shell {
        padding: 14px;
      }

      .panel {
        padding: 16px;
      }

      .form-grid,
      .soft-grid,
      .split-input,
      .lang-row {
        grid-template-columns: 1fr;
      }

      .timer-chip {
        top: 12px;
        right: 12px;
        padding: 8px 12px;
      }

      .clear-data-btn {
        right: 104px;
        top: 12px;
        padding: 8px 10px;
        font-size: 0.72rem;
      }
    }
  </style>
</head>
<body>
  <div id="timer" class="timer-chip hidden" aria-live="polite">90:00</div>
  <button id="clearDataBtn" class="clear-data-btn" type="button">CLEAR DATA</button>
  <div id="expiredOverlay" class="expired-overlay hidden" role="status">
    Transmission window has closed â€” but your data is saved. Submit when ready.
  </div>

  <div id="introView" class="intro-only active">
    <section class="mission-intro">
      <div class="intro-card">
        <div class="logo">MARS-1</div>
        <h1 class="intro-title">MARS-1 SPECIALIST EXPANSION PROGRAMME</h1>
        <div class="intro-sub">RECRUITMENT CYCLE: 2031-B</div>
        <div id="typewriterText" class="typewriter" aria-live="polite"></div>
        <div class="muted-tiny" style="font-size:0.9rem;">Transmission Window: <strong id="introCountdown">90:00</strong></div>
        <div class="intro-btn-wrap">
          <button id="accessPortalBtn" class="btn primary launch" type="button">ACCESS PORTAL <i class="fa-solid fa-arrow-right"></i></button>
          <div class="muted-tiny">Your progress is saved automatically.</div>
        </div>
      </div>
    </section>
  </div>

  <div id="mainApp" class="main-app">
    <div class="app-shell">
      <div class="layout">
        <aside class="phase-rail" aria-label="Application phases">
          <h3>CV Sections</h3>
          <div id="stepper" class="progress-stepper" aria-label="Progress steps"></div>
        </aside>

        <main class="panel" id="panelRoot">
          <section id="section-2" class="section" data-step="2">
            <div class="heading">
              <p class="eyebrow">Step 2</p>
              <h2>Personal Information</h2>
            </div>

            <div class="form-grid">
              <div class="field" data-required="true">
                <label for="fullName" class="required">Full Name</label>
                <input id="fullName" name="fullName" type="text" required />
                <div class="error-msg">This field is required.</div>
              </div>
              <div class="field" data-required="true">
                <label for="email" class="required">Email Address</label>
                <input id="email" name="email" type="email" required />
                <div class="error-msg">Enter a valid email address.</div>
              </div>
              <div class="field">
                <label>Colony Unit ID</label>
                <div class="badge" id="unitIdBadge"><i class="fa-solid fa-satellite-dish"></i> <span id="unitIdText"></span></div>
              </div>
              <div class="field" data-required="true">
                <label for="specialisation" class="required">Field Specialisation</label>
                <select id="specialisation" name="specialisation" required>
                  <option value="">Select specialisation</option>
                  <option>Geodesy</option>
                  <option>Geomatics</option>
                  <option>Remote Sensing</option>
                  <option>Cartography</option>
                  <option>Land Surveying</option>
                  <option>GIS Analysis</option>
                  <option>Navigation Systems</option>
                  <option>Other</option>
                </select>
                <div class="error-msg">Please select a specialisation.</div>
              </div>
              <div class="field">
                <label for="university">University</label>
                <input id="university" name="university" type="text" />
              </div>
              <div class="field">
                <label for="country">Country of Origin</label>
                <input id="country" name="country" type="text" />
              </div>
              <div class="field full">
                <label for="linkedin">LinkedIn URL</label>
                <input id="linkedin" name="linkedin" type="text" placeholder="https://www.linkedin.com/in/your-profile" />
              </div>
              <div class="field full">
                <label for="photo">Profile Photo Upload (optional)</label>
                <div class="photo-upload-wrap">
                  <div class="photo-preview" id="photoPreview">No Photo</div>
                  <input id="photo" name="photo" type="file" accept="image/*" />
                </div>
              </div>
            </div>

            <div class="nav">
              <span></span>
              <button type="button" class="btn primary" data-next="3">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-3" class="section" data-step="3">
            <div class="heading">
              <p class="eyebrow">Step 3</p>
              <h2>CANDIDATE PROFILE STATEMENT</h2>
            </div>
            <div class="field full">
              <label for="summary">Professional Summary</label>
              <textarea id="summary" name="summary" rows="6" placeholder="Write your mission-ready professional statement..."></textarea>
              <div id="summaryCounter" class="word-counter">0 words</div>
            </div>

            <div class="helper">
              <details>
                <summary>NEED HELP? USE THIS FRAME <i class="fa-solid fa-chevron-down"></i></summary>
                <p class="subtle">I am a [adjective] [Geodesy/Geomatics] graduate with experience in [area 1] and [area 2]. During my degree, I [verb + achievement]. I am particularly interested in [specialisation] and I am looking for an opportunity to [goal].</p>
                <button id="copyFrameBtn" type="button" class="btn small outline">COPY FRAME</button>
              </details>
            </div>

            <div class="nav">
              <button type="button" class="btn" data-back="2"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="4">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-4" class="section" data-step="4">
            <div class="heading">
              <p class="eyebrow">Step 4</p>
              <h2>ACADEMIC RECORD</h2>
            </div>
            <div id="educationContainer"></div>
            <button id="addEducationBtn" type="button" class="btn outline">+ ADD ANOTHER QUALIFICATION</button>

            <div class="nav">
              <button type="button" class="btn" data-back="3"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="5">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-5" class="section" data-step="5">
            <div class="heading">
              <p class="eyebrow">Step 5</p>
              <h2>FIELD OPERATIONS LOG</h2>
              <p class="subtle">Document your academic projects, research, fieldwork, and laboratory work as professional mission entries.</p>
            </div>
            <div id="projectsContainer"></div>
            <button id="addProjectBtn" type="button" class="btn outline">+ LOG NEW MISSION ENTRY</button>

            <div class="nav">
              <button type="button" class="btn" data-back="4"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="6">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-6" class="section" data-step="6">
            <div class="heading">
              <p class="eyebrow">Step 6</p>
              <h2>TECHNICAL COMPETENCY MATRIX</h2>
            </div>
            <div id="skillsGroups"></div>
            <div class="field full" style="margin-top:12px;">
              <label for="customSkillInput">Add custom skill</label>
              <input id="customSkillInput" type="text" placeholder="Type skill and press Enter" />
            </div>

            <div class="skills-selected">
              <h3 style="font-size:0.9rem; margin:0 0 10px; color:#dff1ff;">YOUR SELECTED SKILLS</h3>
              <div id="selectedSkillsList" class="skills-list"></div>
            </div>

            <div class="nav">
              <button type="button" class="btn" data-back="5"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="7">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-7" class="section" data-step="7">
            <div class="heading">
              <p class="eyebrow">Step 7</p>
              <h2>COMMUNICATION PROTOCOLS</h2>
            </div>
            <div id="languagesContainer"></div>
            <button id="addLanguageBtn" type="button" class="btn outline">+ ADD LANGUAGE</button>

            <div class="nav">
              <button type="button" class="btn" data-back="6"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="8">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-8" class="section" data-step="8">
            <div class="heading">
              <p class="eyebrow">Step 8</p>
              <h2>INTERPERSONAL COMPETENCIES</h2>
            </div>
            <div id="softSkillsWrap" class="soft-grid"></div>
            <div id="softCounter" class="counter">0/5 selected</div>
            <div class="field full" style="margin-top:12px;">
              <label for="customSoftSkill">Add your own (optional)</label>
              <input id="customSoftSkill" type="text" />
            </div>

            <div class="nav">
              <button type="button" class="btn" data-back="7"><i class="fa-solid fa-arrow-left"></i> Back</button>
              <button type="button" class="btn primary" data-next="9">Next <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-9" class="section" data-step="9">
            <div class="heading">
              <p class="eyebrow">Step 9</p>
              <h2>Preview & Review</h2>
            </div>
            <div class="preview-shell">
              <div class="cv-card" id="cvPreview"></div>
            </div>
            <div id="submissionValidationAlert" class="submission-alert" role="alert" aria-live="assertive"></div>

            <div class="nav">
              <button type="button" class="btn" data-back="2"><i class="fa-solid fa-arrow-left"></i> EDIT MY APPLICATION</button>
              <button id="submitApplicationBtn" type="button" class="btn primary" data-next="10">SUBMIT APPLICATION <i class="fa-solid fa-arrow-right"></i></button>
            </div>
          </section>

          <section id="section-10" class="section" data-step="10">
            <div class="heading">
              <p class="eyebrow">Step 10</p>
              <h2>Ready for Submission</h2>
              <p class="subtle">Click below to begin secure transmission sequence.</p>
            </div>
            <button id="startSubmissionBtn" class="btn primary" type="button">INITIATE MARS-1 TRANSMISSION</button>
            <div class="nav">
              <button type="button" class="btn" data-back="9"><i class="fa-solid fa-arrow-left"></i> Back</button>
            </div>
          </section>
        </main>

        <aside class="right-rail" aria-label="Status and preview">
          <div class="mars-card" aria-label="MARS-1 rotating insignia">
            <div class="mars-orbit-wrap" aria-hidden="true">
              <div class="mars-logo"></div>
              <div id="marsSatellite" class="mars-satellite">
                <span class="satellite-trail"></span>
                <span class="satellite-core"></span>
              </div>
            </div>
            <div class="mars-label"><strong>MARS-1</strong>Orbital Relay Signal<br>Active</div>
          </div>
          <div class="sidebar" aria-label="Profile completeness">
            <h3>Profile Completeness</h3>
            <div id="completionPct" class="completion">0%</div>
            <div class="bar" aria-hidden="true"><span id="completionBar"></span></div>
            <p>Complete all sections to maximize mission readiness. Your data syncs locally on every change.</p>
          </div>
          <div class="live-sidebar" aria-label="Live profile preview">
            <h3>Live Profile Preview</h3>
            <div class="preview-mini" id="globalLivePanel"></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <div id="submissionOverlay" class="submission-overlay" aria-live="polite" aria-modal="true" role="dialog">
    <div class="submission-card">
      <div id="submissionContent"></div>
    </div>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = "mars1.portal.data.v1";
      const TIMER_KEY = "mars1.portal.timer.v1";
      const TOTAL_SECONDS = 90 * 60;
      const MAX_PROJECTS = 6;
      const MAX_LANGUAGES = 6;
      const STEP_LABELS = [
        "Mission", "Personal", "Summary", "Education", "Field Log", "Skills", "Languages", "Soft Skills", "Preview", "Submit"
      ];

      const SOFT_SKILLS = [
        "Problem-solving under pressure",
        "Cross-cultural communication",
        "Team leadership",
        "Attention to detail",
        "Adaptability",
        "Data-driven decision making",
        "Project management",
        "Technical communication",
        "Independent research",
        "Time management",
        "Creative thinking",
        "Conflict resolution"
      ];

      const SKILL_GROUPS = {
        "GEOSPATIAL SOFTWARE": ["QGIS", "ArcGIS", "AutoCAD", "Global Mapper", "Agisoft Metashape", "Trimble Business Center"],
        "PROGRAMMING": ["Python", "MATLAB", "R", "SQL"],
        "FIELD EQUIPMENT": ["GNSS receivers", "Total Station", "UAV/Drone operation", "Terrestrial laser scanning"],
        "DATA & REPORTING": ["Microsoft Office", "Google Suite", "Technical report writing", "Data visualisation"]
      };

      const PROJECT_TOOL_SUGGESTIONS = [
        "QGIS", "ArcGIS", "AutoCAD", "GNSS receivers", "Python", "Drone surveying", "Total station", "Photogrammetry", "Remote sensing", "GIS", "Matlab", "Field data collection", "Statistical analysis", "Technical reporting"
      ];

      const ACTION_VERBS = [
        "Conducted", "Led", "Developed", "Analysed", "Designed", "Implemented", "Managed", "Delivered", "Built", "Coordinated", "Produced", "Optimised", "Validated", "Integrated", "Processed"
      ];

      const LEVEL_MAP = {
        Native: 100,
        C2: 95,
        C1: 85,
        B2: 75,
        B1: 65,
        A2: 50,
        A1: 35
      };

      const PROJECT_BULLET_PREVIEW_HINT = "Complete at least two fields above to preview your bullet point.";

      const introView = document.getElementById("introView");
      const mainApp = document.getElementById("mainApp");
      const timerChip = document.getElementById("timer");
      const expiredOverlay = document.getElementById("expiredOverlay");
      const stepperEl = document.getElementById("stepper");
      const completionPctEl = document.getElementById("completionPct");
      const completionBarEl = document.getElementById("completionBar");
      const panelRoot = document.getElementById("panelRoot");
      const submissionOverlay = document.getElementById("submissionOverlay");
      const submissionContent = document.getElementById("submissionContent");

      let timerInterval = null;
      let typewriterInterval = null;
      let introCountdownInterval = null;
      let docxReadyPromise = null;
      let satelliteOrbitRAF = null;
      let currentStep = 2;

      const state = {
        appStarted: false,
        currentStep: 2,
        unitId: "",
        personal: {
          fullName: "",
          email: "",
          specialisation: "",
          university: "",
          country: "",
          linkedin: "",
          photoDataUrl: ""
        },
        summary: "",
        education: [],
        projects: [],
        technicalSkills: [],
        languages: [{ language: "English", level: "C1" }],
        softSkills: [],
        customSoftSkill: ""
      };

      function uid() {
        return Math.random().toString(36).slice(2, 11);
      }

      function createUnitId() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let value = "";
        for (let i = 0; i < 8; i++) value += chars[Math.floor(Math.random() * chars.length)];
        return `UNIT-${value}`;
      }

      function escapeHtml(str) {
        return String(str || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/\"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          Object.assign(state, parsed);
          if (!state.personal) state.personal = {};
          state.personal = {
            fullName: "",
            email: "",
            specialisation: "",
            university: "",
            country: "",
            linkedin: "",
            photoDataUrl: "",
            ...state.personal
          };
          if (!Array.isArray(state.education)) state.education = [];
          state.education = state.education.map((e) => ({
            id: e.id || uid(),
            institution: e.institution || "",
            degree: e.degree || "",
            startYear: e.startYear || "",
            endYear: e.endYear || "",
            present: !!e.present,
            grade: e.grade || "",
            modules: Array.isArray(e.modules) ? e.modules : []
          }));
          if (!Array.isArray(state.projects)) state.projects = [];
          state.projects = state.projects.map((p) => ({
            id: p.id || uid(),
            title: p.title || "",
            role: p.role || "",
            period: p.period || "",
            tools: Array.isArray(p.tools) ? p.tools : [],
            actionVerb: p.actionVerb || "Conducted",
            did: p.did || "",
            toolsText: p.toolsText || "",
            outcome: p.outcome || "",
            bullet: p.bullet || ""
          }));
          if (!Array.isArray(state.technicalSkills)) state.technicalSkills = [];
          if (!Array.isArray(state.languages) || !state.languages.length) state.languages = [{ language: "English", level: "C1" }];
          state.languages = state.languages.map((l) => ({
            language: l.language || "",
            level: l.level || "B2"
          }));
          if (!Array.isArray(state.softSkills)) state.softSkills = [];
          if (typeof state.customSoftSkill !== "string") state.customSoftSkill = "";
        } catch (err) {
          console.error("Failed to load state", err);
        }
      }

      function buildStepper() {
        stepperEl.innerHTML = "";
        STEP_LABELS.forEach((label, i) => {
          const step = i + 1;
          const div = document.createElement("div");
          div.className = "step-pill";
          div.textContent = `${step}. ${label}`;
          if (step < currentStep) div.classList.add("done");
          if (step === currentStep) div.classList.add("active");
          stepperEl.appendChild(div);
        });
      }

      function showSection(step) {
        if (step < 2 || step > 10) return;
        currentStep = step;
        state.currentStep = step;
        saveState();
        document.querySelectorAll(".section").forEach((el) => {
          el.classList.toggle("active", el.id === `section-${step}`);
        });
        if (step === 9) {
          renderPreview();
        }
        buildStepper();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function startApp() {
        clearInterval(introCountdownInterval);
        state.appStarted = true;
        introView.classList.remove("active");
        mainApp.classList.add("active");
        timerChip.classList.remove("hidden");
        saveState();
        ensureTimer();
        showSection(currentStep);
      }

      function ensureUnitId() {
        if (!state.unitId) {
          state.unitId = createUnitId();
        }
        document.getElementById("unitIdText").textContent = state.unitId;
      }

      function wirePersonalFields() {
        const map = {
          fullName: "fullName",
          email: "email",
          specialisation: "specialisation",
          university: "university",
          country: "country",
          linkedin: "linkedin"
        };

        Object.entries(map).forEach(([key, id]) => {
          const input = document.getElementById(id);
          input.value = state.personal[key] || "";
          input.addEventListener("input", () => {
            state.personal[key] = input.value;
            saveState();
            updateCompleteness();
            updateLiveMiniPreview();
            if (key === "fullName" || key === "specialisation") renderPreview();
          });
        });

        const photoInput = document.getElementById("photo");
        photoInput.addEventListener("change", (e) => {
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function () {
            state.personal.photoDataUrl = reader.result;
            saveState();
            renderPhotoPreview();
            renderPreview();
          };
          reader.readAsDataURL(file);
        });
        renderPhotoPreview();
      }

      function renderPhotoPreview() {
        const box = document.getElementById("photoPreview");
        if (state.personal.photoDataUrl) {
          box.innerHTML = `<img src="${state.personal.photoDataUrl}" alt="Profile photo preview" />`;
        } else {
          box.textContent = "No Photo";
        }
      }

      function wireSummary() {
        const summary = document.getElementById("summary");
        const counter = document.getElementById("summaryCounter");
        summary.value = state.summary || "";

        function update() {
          state.summary = summary.value;
          const words = summary.value.trim() ? summary.value.trim().split(/\s+/).length : 0;
          counter.textContent = `${words} words`;
          counter.classList.toggle("over", words > 150);
          saveState();
          updateCompleteness();
          renderPreview();
        }

        summary.addEventListener("input", update);
        update();

        document.getElementById("copyFrameBtn").addEventListener("click", () => {
          summary.value = "I am a motivated Geomatics graduate with experience in [area 1] and [area 2]. During my degree, I [verb + achievement]. I am particularly interested in [specialisation] and I am looking for an opportunity to [goal].";
          summary.dispatchEvent(new Event("input"));
          summary.focus();
        });
      }

      function makeTagInput(container, values, onChange, suggestions) {
        const wrapper = document.createElement("div");
        wrapper.className = "tag-input-wrap";
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Type and press Enter";
        wrapper.appendChild(input);

        function renderTags() {
          wrapper.querySelectorAll(".tag").forEach((tag) => tag.remove());
          values.forEach((tagText, idx) => {
            const tag = document.createElement("span");
            tag.className = "tag";
            tag.innerHTML = `${escapeHtml(tagText)} <span class="x" data-idx="${idx}">&times;</span>`;
            wrapper.insertBefore(tag, input);
          });
        }

        wrapper.addEventListener("click", (e) => {
          if (e.target.classList.contains("x")) {
            const idx = Number(e.target.dataset.idx);
            values.splice(idx, 1);
            renderTags();
            onChange(values);
          }
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const val = input.value.trim();
            if (!val) return;
            if (!values.includes(val)) {
              values.push(val);
              renderTags();
              onChange(values);
            }
            input.value = "";
          }
        });

        if (Array.isArray(suggestions) && suggestions.length) {
          const chips = document.createElement("div");
          chips.className = "chips";
          suggestions.forEach((s) => {
            const chip = document.createElement("button");
            chip.type = "button";
            chip.className = "chip";
            chip.textContent = s;
            chip.addEventListener("click", () => {
              if (!values.includes(s)) {
                values.push(s);
                renderTags();
                onChange(values);
              }
            });
            chips.appendChild(chip);
          });
          container.appendChild(chips);
        }

        container.appendChild(wrapper);
        renderTags();
      }

      function addEducationEntry(entry) {
        const data = entry || {
          id: uid(),
          institution: "",
          degree: "",
          startYear: "",
          endYear: "",
          present: false,
          grade: "",
          modules: []
        };
        if (!state.education.find((e) => e.id === data.id)) {
          state.education.push(data);
        }
        renderEducation();
      }

      function renderEducation() {
        const container = document.getElementById("educationContainer");
        container.innerHTML = "";

        state.education.forEach((entry) => {
          const card = document.createElement("div");
          card.className = "entry-card";
          card.innerHTML = `
            <button type="button" class="entry-remove" title="Remove" data-remove="${entry.id}">&times;</button>
            <div class="form-grid">
              <div class="field"><label>Institution name</label><input type="text" data-field="institution" value="${escapeHtml(entry.institution)}" /></div>
              <div class="field"><label>Degree title</label><input type="text" data-field="degree" value="${escapeHtml(entry.degree)}" /></div>
              <div class="field"><label>Start year</label><input type="number" min="1900" max="2100" data-field="startYear" value="${escapeHtml(entry.startYear)}" /></div>
              <div class="field">
                <label>End year</label>
                <input type="number" min="1900" max="2100" data-field="endYear" value="${escapeHtml(entry.endYear)}" ${entry.present ? "disabled" : ""} />
                <label style="display:flex; align-items:center; gap:8px; font-size:0.8rem; margin-top:6px; color:var(--muted);"><input type="checkbox" data-field="present" ${entry.present ? "checked" : ""} /> Present</label>
              </div>
              <div class="field"><label>Final grade / GPA</label><input type="text" data-field="grade" value="${escapeHtml(entry.grade)}" /></div>
              <div class="field full"><label>Relevant modules</label><div class="modules-holder"></div></div>
            </div>
          `;

          card.addEventListener("input", (e) => {
            const field = e.target.dataset.field;
            if (!field) return;
            if (field === "present") {
              entry.present = e.target.checked;
              if (entry.present) {
                entry.endYear = "";
              }
              renderEducation();
              saveState();
              updateCompleteness();
              renderPreview();
              return;
            }
            entry[field] = e.target.value;
            saveState();
            updateCompleteness();
            renderPreview();
          });

          card.querySelector("[data-remove]").addEventListener("click", () => {
            state.education = state.education.filter((x) => x.id !== entry.id);
            saveState();
            renderEducation();
            updateCompleteness();
            renderPreview();
          });

          const moduleHolder = card.querySelector(".modules-holder");
          makeTagInput(moduleHolder, entry.modules, () => {
            saveState();
            updateCompleteness();
            renderPreview();
          });

          container.appendChild(card);
        });

        if (!state.education.length) {
          const empty = document.createElement("p");
          empty.className = "subtle";
          empty.textContent = "No qualifications added yet.";
          container.appendChild(empty);
        }
      }

      function countProjectBuilderFields(project) {
        return [project.did, project.toolsText, project.outcome].filter((value) => (value || "").trim().length > 0).length;
      }

      function canGenerateProjectBullet(project) {
        return countProjectBuilderFields(project) >= 2;
      }

      function buildProjectBullet(project) {
        if (!canGenerateProjectBullet(project)) return "";
        const action = project.actionVerb || "Conducted";
        const did = (project.did || "").trim() || "a geospatial task";
        const didWithVerb = new RegExp(`^${action}\\b`, "i").test(did) ? did : `${action} ${did}`;
        const tools = (project.toolsText || "").trim() || "relevant tools";
        const outcome = (project.outcome || "").trim() || "a measurable output";
        return `${didWithVerb} using ${tools}, resulting in ${outcome}.`;
      }

      function isPreviewHintText(text) {
        return (text || "").trim() === PROJECT_BULLET_PREVIEW_HINT;
      }

      function projectBulletPreview(project) {
        const generated = buildProjectBullet(project);
        return generated || PROJECT_BULLET_PREVIEW_HINT;
      }

      function getProjectBulletForOutput(project) {
        const manualBullet = (project.bullet || "").trim();
        if (manualBullet && !isPreviewHintText(manualBullet)) return manualBullet;
        return buildProjectBullet(project);
      }

      function addProjectEntry(entry) {
        if (state.projects.length >= MAX_PROJECTS) return;
        const data = entry || {
          id: uid(),
          title: "",
          role: "",
          period: "",
          tools: [],
          actionVerb: "Conducted",
          did: "",
          toolsText: "",
          outcome: "",
          bullet: ""
        };
        if (!data.bullet) data.bullet = projectBulletPreview(data);
        if (!state.projects.find((p) => p.id === data.id)) {
          state.projects.push(data);
        }
        renderProjects();
      }

      function renderProjects() {
        const container = document.getElementById("projectsContainer");
        container.innerHTML = "";
        state.projects.forEach((p) => {
          const card = document.createElement("div");
          card.className = "entry-card";
          const previewText = (p.bullet || "").trim() ? p.bullet : projectBulletPreview(p);
          const previewIsHint = isPreviewHintText(previewText);
          card.innerHTML = `
            <button type="button" class="entry-remove" title="Remove" data-remove="${p.id}">&times;</button>
            <div class="form-grid">
              <div class="field"><label>Project / Mission Title</label><input data-field="title" type="text" value="${escapeHtml(p.title)}" /></div>
              <div class="field"><label>Your Role</label><input data-field="role" type="text" value="${escapeHtml(p.role)}" /></div>
              <div class="field"><label>Year / Period</label><input data-field="period" type="text" value="${escapeHtml(p.period)}" /></div>
              <div class="field full"><label>Tools & Methods Used</label><div class="project-tools"></div></div>
              <div class="field full">
                <label>Bullet Point Builder</label>
                <div class="split-input">
                  <input data-field="did" type="text" placeholder="What did you DO?" value="${escapeHtml(p.did)}" />
                  <input data-field="toolsText" type="text" placeholder="What TOOLS or METHODS did you use?" value="${escapeHtml(p.toolsText)}" />
                  <input data-field="outcome" type="text" placeholder="What was the OUTCOME or RESULT?" value="${escapeHtml(p.outcome)}" />
                </div>
                <div class="field" style="margin-top:8px;">
                  <label>Add Action Verb</label>
                  <select data-field="actionVerb">
                    ${ACTION_VERBS.map(v => `<option ${v === p.actionVerb ? "selected" : ""}>${v}</option>`).join("")}
                  </select>
                </div>
                <div class="small-caption">Preview / editable bullet</div>
                <textarea data-field="bullet" rows="2" class="${previewIsHint ? "bullet-hint" : ""}">${escapeHtml(previewText)}</textarea>
              </div>
            </div>
          `;

          const recalc = () => {
            const bullet = card.querySelector('textarea[data-field="bullet"]');
            const generated = buildProjectBullet(p);
            if (generated) {
              p.bullet = generated;
              if (document.activeElement !== bullet) {
                bullet.value = p.bullet;
              }
              bullet.classList.remove("bullet-hint");
            } else {
              p.bullet = PROJECT_BULLET_PREVIEW_HINT;
              if (document.activeElement !== bullet) {
                bullet.value = PROJECT_BULLET_PREVIEW_HINT;
              }
              bullet.classList.add("bullet-hint");
            }
          };

          const handleProjectInput = (e) => {
            const field = e.target.dataset.field;
            if (!field) return;
            p[field] = e.target.value;
            if (field === "actionVerb") {
              const didInput = card.querySelector('input[data-field="did"]');
              const stripped = (p.did || "").replace(new RegExp(`^(${ACTION_VERBS.join("|")})\\s+`, "i"), "").trim();
              p.did = `${p.actionVerb} ${stripped}`.trim();
              didInput.value = p.did;
            }
            if (["did", "toolsText", "outcome", "actionVerb"].includes(field)) {
              recalc();
            } else if (field === "bullet") {
              const bullet = card.querySelector('textarea[data-field="bullet"]');
              bullet.classList.toggle("bullet-hint", isPreviewHintText(p.bullet));
            }
            saveState();
            updateCompleteness();
            renderPreview();
          };

          card.addEventListener("input", handleProjectInput);
          card.addEventListener("change", handleProjectInput);

          card.querySelector("[data-remove]").addEventListener("click", () => {
            state.projects = state.projects.filter((x) => x.id !== p.id);
            saveState();
            renderProjects();
            updateCompleteness();
            renderPreview();
          });

          const toolsBox = card.querySelector(".project-tools");
          makeTagInput(toolsBox, p.tools, () => {
            saveState();
            updateCompleteness();
            renderPreview();
          }, PROJECT_TOOL_SUGGESTIONS);

          container.appendChild(card);
        });

        document.getElementById("addProjectBtn").disabled = state.projects.length >= MAX_PROJECTS;

        if (!state.projects.length) {
          const empty = document.createElement("p");
          empty.className = "subtle";
          empty.textContent = "No mission entries yet.";
          container.appendChild(empty);
        }
      }

      function renderSkillsMatrix() {
        const host = document.getElementById("skillsGroups");
        host.innerHTML = "";

        Object.entries(SKILL_GROUPS).forEach(([group, skills]) => {
          const block = document.createElement("div");
          block.className = "helper";
          block.innerHTML = `<div style="font-weight:700; color:#dbeeff; font-size:0.82rem; letter-spacing:0.06em;">${group}</div>`;
          const chips = document.createElement("div");
          chips.className = "chips";
          skills.forEach((skill) => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "chip" + (state.technicalSkills.includes(skill) ? " selected" : "");
            btn.textContent = skill;
            btn.addEventListener("click", () => {
              toggleSkill(skill);
              renderSkillsMatrix();
              renderSelectedSkills();
              saveState();
              updateCompleteness();
              renderPreview();
            });
            chips.appendChild(btn);
          });
          block.appendChild(chips);
          host.appendChild(block);
        });
      }

      function toggleSkill(skill) {
        const idx = state.technicalSkills.indexOf(skill);
        if (idx > -1) state.technicalSkills.splice(idx, 1);
        else state.technicalSkills.push(skill);
      }

      function renderSelectedSkills() {
        const list = document.getElementById("selectedSkillsList");
        list.innerHTML = "";
        state.technicalSkills.forEach((s, index) => {
          const tag = document.createElement("span");
          tag.className = "tag";
          tag.draggable = true;
          tag.dataset.index = index;
          tag.innerHTML = `${escapeHtml(s)} <span class="x" data-remove-skill="${escapeHtml(s)}">&times;</span>`;

          tag.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", String(index));
          });

          tag.addEventListener("dragover", (e) => e.preventDefault());
          tag.addEventListener("drop", (e) => {
            e.preventDefault();
            const from = Number(e.dataTransfer.getData("text/plain"));
            const to = Number(tag.dataset.index);
            if (Number.isNaN(from) || Number.isNaN(to) || from === to) return;
            const moved = state.technicalSkills.splice(from, 1)[0];
            state.technicalSkills.splice(to, 0, moved);
            saveState();
            renderSelectedSkills();
            renderPreview();
          });

          list.appendChild(tag);
        });

        list.onclick = (e) => {
          const skill = e.target.dataset.removeSkill;
          if (!skill) return;
          state.technicalSkills = state.technicalSkills.filter((x) => x !== skill);
          saveState();
          renderSelectedSkills();
          renderSkillsMatrix();
          updateCompleteness();
          renderPreview();
        };
      }

      function addLanguageEntry(entry) {
        if (state.languages.length >= MAX_LANGUAGES) return;
        const data = entry || { language: "", level: "B2" };
        state.languages.push(data);
        renderLanguages();
      }

      function renderLanguages() {
        const container = document.getElementById("languagesContainer");
        container.innerHTML = "";

        state.languages.forEach((lang, idx) => {
          const row = document.createElement("div");
          row.className = "entry-card";
          row.innerHTML = `
            ${idx === 0 ? "" : `<button type="button" class="entry-remove" data-remove="${idx}">&times;</button>`}
            <div class="lang-row">
              <div class="field" style="margin:0;"><label>Language</label>
                <input type="text" data-field="language" value="${escapeHtml(lang.language || "")}" list="languageSuggestions" />
              </div>
              <div class="field" style="margin:0;"><label>Level</label>
                <select data-field="level">
                  ${["Native", "C2", "C1", "B2", "B1", "A2", "A1"].map(l => `<option ${l === lang.level ? "selected" : ""}>${l}</option>`).join("")}
                </select>
              </div>
              <div>
                <div class="small-caption" style="margin-top:0;">Proficiency</div>
                <div class="lang-meter"><span style="width:${LEVEL_MAP[lang.level] || 0}%"></span></div>
              </div>
            </div>
          `;

          row.addEventListener("input", (e) => {
            const f = e.target.dataset.field;
            lang[f] = e.target.value;
            if (f === "level") {
              const meter = row.querySelector(".lang-meter span");
              meter.style.width = `${LEVEL_MAP[lang.level] || 0}%`;
            }
            saveState();
            updateCompleteness();
            renderPreview();
          });

          const rm = row.querySelector("[data-remove]");
          if (rm) {
            rm.addEventListener("click", () => {
              state.languages.splice(idx, 1);
              saveState();
              renderLanguages();
              updateCompleteness();
              renderPreview();
            });
          }

          container.appendChild(row);
        });

        document.getElementById("addLanguageBtn").disabled = state.languages.length >= MAX_LANGUAGES;
      }

      function renderSoftSkills() {
        const host = document.getElementById("softSkillsWrap");
        host.innerHTML = "";

        SOFT_SKILLS.forEach((skill) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "soft-option" + (state.softSkills.includes(skill) ? " active" : "");
          btn.textContent = skill;
          btn.addEventListener("click", () => {
            const exists = state.softSkills.includes(skill);
            if (exists) {
              state.softSkills = state.softSkills.filter((s) => s !== skill);
            } else if (state.softSkills.length < 5) {
              state.softSkills.push(skill);
            }
            saveState();
            renderSoftSkills();
            updateCompleteness();
            renderPreview();
          });
          host.appendChild(btn);
        });

        document.getElementById("softCounter").textContent = `${state.softSkills.length}/5 selected`;
      }

      function updateLiveMiniPreview() {
        const lp = document.getElementById("livePanel");
        const glp = document.getElementById("globalLivePanel");
        const template = () => {
          const name = state.personal.fullName || "Candidate Name";
          const spec = state.personal.specialisation || "Specialisation";
          const email = state.personal.email || "email@example.com";
          return `
            <h5>Live Candidate Snapshot</h5>
            <ul class="mini-list">
              <li><span class="tiny-badge">ID</span>${escapeHtml(state.unitId || "UNIT-XXXXXX")}</li>
              <li><span class="tiny-badge">NAME</span>${escapeHtml(name)}</li>
              <li><span class="tiny-badge">SPEC</span>${escapeHtml(spec)}</li>
              <li><span class="tiny-badge">EMAIL</span>${escapeHtml(email)}</li>
              <li><span class="tiny-badge">SKILLS</span>${state.technicalSkills.length} selected</li>
              <li><span class="tiny-badge">LOGS</span>${state.projects.length} mission entries</li>
            </ul>
          `;
        };
        if (lp) lp.innerHTML = template();
        if (glp) glp.innerHTML = template();
      }

      function renderPreview() {
        const card = document.getElementById("cvPreview");
        if (!card) return;

        const p = state.personal;
        const photo = p.photoDataUrl ? `<img src="${p.photoDataUrl}" alt="Photo" style="width:76px;height:76px;border-radius:999px;object-fit:cover;border:2px solid #d2e2ef;">` : "";

        const eduHtml = state.education.map((e) => `
          <div class="cv-item"><strong>${escapeHtml(e.degree || "Degree")}</strong> â€” ${escapeHtml(e.institution || "Institution")}<br>
          ${escapeHtml(e.startYear || "-")} - ${e.present ? "Present" : escapeHtml(e.endYear || "-")}${e.grade ? ` | Grade: ${escapeHtml(e.grade)}` : ""}
          ${e.modules && e.modules.length ? `<div style="margin-top:4px;">${e.modules.map((m) => `<span class=\"cv-tag\">${escapeHtml(m)}</span>`).join(" ")}</div>` : ""}
          </div>
        `).join("") || `<div class="cv-item">No education entries yet.</div>`;

        const projectHtml = state.projects.map((pr) => {
          const bulletText = getProjectBulletForOutput(pr) || "No bullet detail provided.";
          return `
          <div class="cv-item"><strong>${escapeHtml(pr.title || "Mission Entry")}</strong> (${escapeHtml(pr.period || "Period")})<br>
          ${escapeHtml(pr.role || "Role")}<br>
          <ul style="margin:6px 0 0 18px; padding:0;"><li>${escapeHtml(bulletText)}</li></ul>
          ${pr.tools && pr.tools.length ? `<div style="margin-top:4px;">${pr.tools.map((t) => `<span class=\"cv-tag\">${escapeHtml(t)}</span>`).join(" ")}</div>` : ""}
          </div>
        `;
        }).join("") || `<div class="cv-item">No mission entries yet.</div>`;

        const skillsHtml = state.technicalSkills.length
          ? `<div class="cv-tags">${state.technicalSkills.map((s) => `<span class="cv-tag">${escapeHtml(s)}</span>`).join("")}</div>`
          : `<div class="cv-item">No skills selected yet.</div>`;

        const langHtml = state.languages.map((l) => `
          <div class="cv-item" style="display:grid; grid-template-columns: 1fr 90px 100px; gap:8px; align-items:center;">
            <span>${escapeHtml(l.language || "Language")}</span>
            <span>${escapeHtml(l.level || "-")}</span>
            <span style="display:block; height:8px; background:#d8e4ef; border-radius:999px; overflow:hidden;"><span style="display:block; height:100%; width:${LEVEL_MAP[l.level] || 0}%; background:#3b82f6;"></span></span>
          </div>
        `).join("") || `<div class="cv-item">No languages listed.</div>`;

        const soft = [...state.softSkills];
        if (state.customSoftSkill.trim()) soft.push(state.customSoftSkill.trim());

        card.innerHTML = `
          <div class="cv-header">
            <div>
              <div class="cv-name">${escapeHtml(p.fullName || "Candidate Name")}</div>
              <div class="cv-small">
                <strong>${escapeHtml(state.unitId || "UNIT-XXXX")}</strong><br>
                ${escapeHtml(p.specialisation || "Specialisation")}<br>
                ${escapeHtml(p.email || "email@example.com")} ${p.linkedin ? `| ${escapeHtml(p.linkedin)}` : ""}
              </div>
            </div>
            <div>${photo}</div>
          </div>

          <section class="cv-sec">
            <h4>PROFILE STATEMENT</h4>
            <div class="cv-item">${escapeHtml(state.summary || "No profile statement yet.")}</div>
          </section>

          <section class="cv-sec"><h4>EDUCATION</h4>${eduHtml}</section>
          <section class="cv-sec"><h4>FIELD OPERATIONS LOG</h4>${projectHtml}</section>
          <section class="cv-sec"><h4>TECHNICAL SKILLS</h4>${skillsHtml}</section>
          <section class="cv-sec"><h4>LANGUAGES</h4>${langHtml}</section>
          <section class="cv-sec"><h4>SOFT SKILLS</h4>${soft.length ? `<div class="cv-tags">${soft.map((s) => `<span class="cv-tag">${escapeHtml(s)}</span>`).join("")}</div>` : `<div class="cv-item">No soft skills selected.</div>`}</section>

          <div class="cv-watermark">MARS-1 CAREER PORTAL</div>
        `;

        updateLiveMiniPreview();
      }

      function updateCompleteness() {
        const hasCompletedEducation = state.education.some((entry) =>
          (entry.institution || "").trim() && (entry.degree || "").trim()
        );

        const hasCompletedProject = state.projects.some((project) => {
          const hasTitle = (project.title || "").trim().length > 0;
          const bullet = getProjectBulletForOutput(project);
          const hasBuilderContent = [(project.did || "").trim(), (project.toolsText || "").trim(), (project.outcome || "").trim()].some(Boolean);
          return hasTitle && (hasBuilderContent || !!bullet);
        });

        const hasOnlyDefaultLanguage =
          state.languages.length === 1 &&
          (state.languages[0].language || "").trim().toLowerCase() === "english" &&
          (state.languages[0].level || "").trim().toUpperCase() === "C1";

        const hasCompletedLanguages =
          !hasOnlyDefaultLanguage &&
          state.languages.some((lang) => (lang.language || "").trim().length > 0 && (lang.level || "").trim().length > 0);

        const checks = [
          !!state.personal.fullName.trim(),
          !!state.personal.email.trim(),
          !!state.personal.specialisation.trim(),
          !!state.summary.trim(),
          hasCompletedEducation,
          hasCompletedProject,
          state.technicalSkills.length > 0,
          hasCompletedLanguages,
          state.softSkills.length > 0 || !!state.customSoftSkill.trim()
        ];

        const done = checks.filter(Boolean).length;
        const pct = Math.round((done / checks.length) * 100);
        completionPctEl.textContent = `${pct}%`;
        completionBarEl.style.width = `${pct}%`;
      }

      function validateStep(step) {
        const section = document.getElementById(`section-${step}`);
        if (!section) return true;

        section.querySelectorAll(".field.invalid").forEach((f) => f.classList.remove("invalid"));
        section.querySelectorAll(".error").forEach((x) => x.classList.remove("error"));

        if (step === 2) {
          let ok = true;
          const required = [
            { id: "fullName", valid: (v) => v.trim().length > 0 },
            { id: "email", valid: (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v) },
            { id: "specialisation", valid: (v) => !!v.trim() }
          ];

          required.forEach((r) => {
            const input = document.getElementById(r.id);
            const field = input.closest(".field");
            if (!r.valid(input.value || "")) {
              ok = false;
              input.classList.add("error");
              field.classList.add("invalid");
            }
          });
          return ok;
        }

        return true;
      }

      function shakeSubmitButton() {
        const btn = document.getElementById("submitApplicationBtn");
        if (!btn) return;
        btn.classList.remove("shake");
        void btn.offsetWidth;
        btn.classList.add("shake");
        setTimeout(() => btn.classList.remove("shake"), 450);
      }

      function renderSubmissionErrors(errors) {
        const alertBox = document.getElementById("submissionValidationAlert");
        if (!alertBox) return;
        if (!errors.length) {
          alertBox.innerHTML = "";
          alertBox.classList.remove("show");
          return;
        }
        alertBox.innerHTML = `
          ${errors.map((error) => `<div class="line">âš  ${escapeHtml(error)}</div>`).join("")}
          <button type="button" class="review-fix" id="reviewFixBtn">REVIEW & FIX</button>
        `;
        alertBox.classList.add("show");
        const reviewBtn = document.getElementById("reviewFixBtn");
        if (reviewBtn) {
          reviewBtn.addEventListener("click", () => {
            showSection(2);
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
        }
      }

      function getSubmissionValidationErrors() {
        const errors = [];
        const fullName = (state.personal.fullName || "").trim();
        const email = (state.personal.email || "").trim();
        const specialisation = (state.personal.specialisation || "").trim();
        const summary = (state.summary || "").trim();

        if (!fullName || !email || !specialisation || !summary) {
          errors.push("Your profile statement is missing. MARS-1 HQ cannot assess an anonymous candidate.");
        }

        const summaryLower = summary.toLowerCase();
        const summaryTemplates = [
          "i am a [adjective]",
          "[area 1]",
          "[area 2]",
          "[specialisation]",
          "[goal]",
          "copy frame"
        ];
        if (summaryTemplates.some((token) => summaryLower.includes(token))) {
          errors.push("Your profile statement appears to contain template placeholder text. Replace all [brackets] with your own words before submitting.");
        }

        const projectBulletTemplates = [
          "using relevant tools, resulting in a measurable output",
          "resulting in a measurable output",
          "optimised using relevant tools"
        ];
        const hasTemplateProjectBullet = state.projects.some((project) => {
          const bullet = (project.bullet || "").toLowerCase();
          return projectBulletTemplates.some((token) => bullet.includes(token));
        });
        if (hasTemplateProjectBullet) {
          errors.push("One or more mission entries contain auto-generated placeholder text. Edit your bullet points before submitting.");
        }

        const hasEducation = state.education.some((entry) => (entry.institution || "").trim() && (entry.degree || "").trim());
        if (!hasEducation) {
          errors.push("No academic record found. Add at least one qualification to your file.");
        }

        const hasProject = state.projects.some((project) => {
          const title = (project.title || "").trim();
          const builderFields = [(project.did || "").trim(), (project.toolsText || "").trim(), (project.outcome || "").trim()];
          const manualBullet = (project.bullet || "").trim();
          const hasBulletContent = builderFields.some(Boolean) || (manualBullet && !isPreviewHintText(manualBullet));
          return title && hasBulletContent;
        });
        if (!hasProject) {
          errors.push("Your Field Operations Log is empty. MARS-1 requires evidence of field competency.");
        }

        return errors;
      }

      function setupNavigation() {
        panelRoot.addEventListener("click", (e) => {
          const next = e.target.closest("[data-next]");
          const back = e.target.closest("[data-back]");
          if (next) {
            const target = Number(next.dataset.next);
            if (validateStep(currentStep)) {
              if (target === 10) {
                const errors = getSubmissionValidationErrors();
                if (errors.length) {
                  renderSubmissionErrors(errors);
                  shakeSubmitButton();
                  return;
                }
                renderSubmissionErrors([]);
                showSection(10);
              } else {
                showSection(target);
              }
            }
          }
          if (back) {
            showSection(Number(back.dataset.back));
          }
        });
      }

      function restoreInputsFromState() {
        document.getElementById("fullName").value = state.personal.fullName || "";
        document.getElementById("email").value = state.personal.email || "";
        document.getElementById("specialisation").value = state.personal.specialisation || "";
        document.getElementById("university").value = state.personal.university || "";
        document.getElementById("country").value = state.personal.country || "";
        document.getElementById("linkedin").value = state.personal.linkedin || "";
        document.getElementById("summary").value = state.summary || "";
        document.getElementById("customSoftSkill").value = state.customSoftSkill || "";
      }

      function wireButtonsAndDynamicAdds() {
        document.getElementById("addEducationBtn").addEventListener("click", () => {
          addEducationEntry();
          saveState();
          updateCompleteness();
          renderPreview();
        });

        document.getElementById("addProjectBtn").addEventListener("click", () => {
          addProjectEntry();
          saveState();
          updateCompleteness();
          renderPreview();
        });

        document.getElementById("addLanguageBtn").addEventListener("click", () => {
          addLanguageEntry();
          saveState();
          updateCompleteness();
          renderPreview();
        });

        document.getElementById("customSkillInput").addEventListener("keydown", (e) => {
          if (e.key !== "Enter") return;
          e.preventDefault();
          const val = e.target.value.trim();
          if (!val) return;
          if (!state.technicalSkills.includes(val)) state.technicalSkills.push(val);
          e.target.value = "";
          saveState();
          renderSkillsMatrix();
          renderSelectedSkills();
          updateCompleteness();
          renderPreview();
        });

        document.getElementById("customSoftSkill").addEventListener("input", (e) => {
          state.customSoftSkill = e.target.value;
          saveState();
          updateCompleteness();
          renderPreview();
        });

        document.getElementById("startSubmissionBtn").addEventListener("click", runSubmissionSequence);
        document.getElementById("clearDataBtn").addEventListener("click", clearAllDataWithConfirmation);
      }

      function clearAllDataWithConfirmation() {
        const confirmed = window.confirm("This will erase the whole process and clear all saved data. Do you want to continue?");
        if (!confirmed) return;
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(TIMER_KEY);
        window.location.reload();
      }

      function typewriterIntro() {
        const el = document.getElementById("typewriterText");
        const message = "Attention, Candidate. MARS-1 Central Command is expanding its specialist workforce. Your colony performance data has flagged you as a potential asset. You have 90:00 to complete and submit your application. The transmission window closes automatically. Begin now.";
        let i = 0;
        clearInterval(typewriterInterval);
        typewriterInterval = setInterval(() => {
          el.textContent = message.slice(0, i);
          i++;
          if (i > message.length) clearInterval(typewriterInterval);
        }, 20);
      }

      function ensureTimer() {
        let meta;
        try {
          meta = JSON.parse(localStorage.getItem(TIMER_KEY) || "null");
        } catch {
          meta = null;
        }

        if (!meta || !meta.startedAt) {
          meta = { startedAt: Date.now() };
          localStorage.setItem(TIMER_KEY, JSON.stringify(meta));
        }

        function tick() {
          const now = Date.now();
          const elapsed = Math.floor((now - meta.startedAt) / 1000);
          const remaining = Math.max(0, TOTAL_SECONDS - elapsed);
          const mm = String(Math.floor(remaining / 60)).padStart(2, "0");
          const ss = String(remaining % 60).padStart(2, "0");
          timerChip.textContent = `${mm}:${ss}`;
          timerChip.classList.remove("warn", "danger");

          if (remaining <= 300) timerChip.classList.add("danger");
          else if (remaining <= 600) timerChip.classList.add("warn");

          expiredOverlay.classList.toggle("hidden", remaining > 0);
        }

        tick();
        clearInterval(timerInterval);
        timerInterval = setInterval(tick, 1000);
      }

      function hideTimerDuringSubmission(hide) {
        timerChip.classList.toggle("hidden", hide);
      }

      function wait(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      function ensureDocxLibrary() {
        if (window.docx) return Promise.resolve(true);
        if (docxReadyPromise) return docxReadyPromise;

        const candidates = [
          "https://unpkg.com/docx@8.5.0/build/index.js",
          "https://unpkg.com/docx@8.5.0/build/index.umd.js",
          "https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"
        ];

        docxReadyPromise = new Promise((resolve) => {
          function alreadyLoaded(src) {
            return Array.from(document.scripts).some((s) => s.src === src);
          }

          function tryLoad(index) {
            if (window.docx) return resolve(true);
            if (index >= candidates.length) return resolve(false);
            const src = candidates[index];
            if (alreadyLoaded(src)) {
              setTimeout(() => tryLoad(index + 1), 250);
              return;
            }

            const script = document.createElement("script");
            script.src = src;
            script.async = true;
            script.onload = () => {
              if (window.docx) resolve(true);
              else tryLoad(index + 1);
            };
            script.onerror = () => tryLoad(index + 1);
            document.head.appendChild(script);
          }

          tryLoad(0);
        });

        return docxReadyPromise;
      }

      function initMarsSatelliteOrbit() {
        const satellite = document.getElementById("marsSatellite");
        if (!satellite || satellite.dataset.orbitInit === "1") return;
        satellite.dataset.orbitInit = "1";

        const prefersReducedMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        if (prefersReducedMotion) {
          satellite.style.transform = "translate(44px, 0px)";
          return;
        }

        const twoPi = Math.PI * 2;
        let theta = Math.random() * twoPi;
        let lastTs = performance.now();

        const randomOrbit = () => ({
          radiusX: 42 + Math.random() * 14,
          radiusY: 30 + Math.random() * 14,
          tilt: Math.random() * twoPi,
          durationMs: 4200 + Math.random() * 4200
        });

        let orbit = randomOrbit();

        const tick = (ts) => {
          const dt = Math.max(8, Math.min(40, ts - lastTs || 16));
          lastTs = ts;
          theta += (twoPi / orbit.durationMs) * dt;

          if (theta >= twoPi) {
            theta -= twoPi;
            orbit = randomOrbit();
          }

          const cosTheta = Math.cos(theta);
          const sinTheta = Math.sin(theta);
          const x = orbit.radiusX * cosTheta;
          const y = orbit.radiusY * sinTheta;
          const cosTilt = Math.cos(orbit.tilt);
          const sinTilt = Math.sin(orbit.tilt);

          const px = x * cosTilt - y * sinTilt;
          const py = x * sinTilt + y * cosTilt;

          const dx = -orbit.radiusX * sinTheta;
          const dy = orbit.radiusY * cosTheta;
          const dpx = dx * cosTilt - dy * sinTilt;
          const dpy = dx * sinTilt + dy * cosTilt;
          const tangentDeg = (Math.atan2(dpy, dpx) * 180) / Math.PI;

          satellite.style.transform = `translate(${px.toFixed(2)}px, ${py.toFixed(2)}px) rotate(${tangentDeg.toFixed(2)}deg)`;
          satelliteOrbitRAF = requestAnimationFrame(tick);
        };

        if (satelliteOrbitRAF) cancelAnimationFrame(satelliteOrbitRAF);
        satelliteOrbitRAF = requestAnimationFrame(tick);
      }

      async function cycleStatus(el, messages, intervalMs, totalMs) {
        const started = Date.now();
        let i = 0;
        while (Date.now() - started < totalMs) {
          el.classList.remove("show");
          await wait(130);
          el.textContent = messages[i % messages.length];
          el.classList.add("show");
          i++;
          await wait(intervalMs);
        }
      }

      async function runSubmissionSequence() {
        const errors = getSubmissionValidationErrors();
        if (errors.length) {
          renderSubmissionErrors(errors);
          showSection(9);
          shakeSubmitButton();
          return;
        }
        renderSubmissionErrors([]);

        submissionOverlay.classList.add("active");
        hideTimerDuringSubmission(true);

        submissionContent.innerHTML = `
          <h2 style="margin:0;">Secure Transmission</h2>
          <p class="subtle" style="margin-top:8px;">Uploading application package to Relay Station 7...</p>
          <div class="upload-bar"><span id="uploadFill"></span></div>
          <div id="uploadPct" style="margin-top:8px; font-weight:700; color:#c9e6ff;">0%</div>
          <div id="status1" class="status-cycle"></div>
        `;

        const uploadFill = document.getElementById("uploadFill");
        const uploadPct = document.getElementById("uploadPct");
        const status1 = document.getElementById("status1");

        const statusPromise1 = cycleStatus(status1, [
          "Encrypting biometric data...",
          "Attaching field operation logs...",
          "Compressing academic record...",
          "Authenticating Colony Unit ID...",
          "Transmitting via Relay Station 7..."
        ], 800, 3500);

        const start = Date.now();
        while (Date.now() - start < 3500) {
          const p = Math.min(100, Math.floor(((Date.now() - start) / 3500) * 100));
          uploadFill.style.width = `${p}%`;
          uploadPct.textContent = `${p}%`;
          await wait(100);
        }
        uploadFill.style.width = "100%";
        uploadPct.textContent = "100%";
        await statusPromise1;

        submissionContent.innerHTML = `
          <h2 style="margin:0;">Processing at MARS-1 HQ</h2>
          <div class="planet" aria-hidden="true"></div>
          <div id="status2" class="status-cycle show"></div>
        `;
        const status2 = document.getElementById("status2");
        await cycleStatus(status2, [
          "Application received by MARS-1 HQ.",
          "Running AI competency scan...",
          "Cross-referencing Colony Unit 7 performance data...",
          "Parsing technical skill matrix...",
          "Analysis in progress..."
        ], 800, 4000);

        submissionContent.innerHTML = `
          <h2 style="margin:0 0 14px;">Assessment Matrix</h2>
          <div class="assess-grid" id="assessGrid"></div>
        `;
        const assessGrid = document.getElementById("assessGrid");
        const rows = [
          "TECHNICAL PROFICIENCY",
          "FIELD ADAPTABILITY",
          "COMMUNICATION INDEX",
          "MISSION READINESS"
        ];

        rows.forEach((label) => {
          const val = Math.floor(Math.random() * 26) + 70;
          const row = document.createElement("div");
          row.className = "assess-row";
          row.innerHTML = `
            <div class="label"><span>${label}</span><span>${val}%</span></div>
            <div class="meter"><span style="width:0%"></span></div>
          `;
          assessGrid.appendChild(row);
          requestAnimationFrame(() => {
            row.querySelector(".meter span").style.width = `${val}%`;
          });
        });

        await wait(3000);

        const now = new Date();
        const dateString = now.toLocaleString();
        const name = state.personal.fullName || "UNSPECIFIED CANDIDATE";
        const spec = state.personal.specialisation || "UNSPECIFIED";
        const unit = state.unitId || "UNIT-UNKNOWN";

        const finalText = `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
MARS-1 CENTRAL COMMAND
PRIORITY TRANSMISSION â€” CLASSIFIED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CANDIDATE: ${name}
COLONY UNIT: ${unit}
SPECIALISATION: ${spec}
SUBMISSION TIMESTAMP: ${dateString}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PRELIMINARY ASSESSMENT: COMPLETE

Your application has been reviewed by the 
MARS-1 AI Screening Module (v4.7).

Based on your academic profile, technical 
competency matrix, and Colony Unit 7 
performance data, you have been:

>> SHORTLISTED 

for the MARS-1 SPECIALIST EXPANSION 
PROGRAMME â€” Recruitment Cycle 2031-B.

You are hereby INVITED to attend a formal 
interview with the MARS-1 HR Director.

DATE: ${nextWeekDateText()} â€” exact scheduling TBC
FORMAT: In-person, Mars Habitat Block C
DURATION: Approximately 20 minutes

Prepare to articulate your professional 
identity and demonstrate mission readiness.

Your colony is counting on you.

â€” MARS-1 CENTRAL COMMAND
   Earth-Mars Relay Division
   Transmission End.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;

        submissionContent.innerHTML = `
          <h2 style="margin:0 0 12px;">HQ Response</h2>
          <div id="terminal" class="terminal"></div>
          <div id="finalActions" class="final-actions">
            <button id="downloadDocxBtn" class="btn primary" type="button">DOWNLOAD APPLICATION (DOCX)</button>
            <button id="reviewCvBtn" class="btn outline" type="button">REVIEW MY CV</button>
          </div>
        `;

        const terminal = document.getElementById("terminal");
        const finalActions = document.getElementById("finalActions");
        let i = 0;

        const revealButtons = () => finalActions.classList.add("show");
        setTimeout(revealButtons, 3000);

        await new Promise((resolve) => {
          const interval = setInterval(() => {
            terminal.textContent = finalText.slice(0, i);
            terminal.scrollTop = terminal.scrollHeight;
            i += 2;
            if (i > finalText.length) {
              clearInterval(interval);
              revealButtons();
              resolve();
            }
          }, 16);
        });

        document.getElementById("downloadDocxBtn").addEventListener("click", generateDocx);
        document.getElementById("reviewCvBtn").addEventListener("click", () => {
          submissionOverlay.classList.remove("active");
          hideTimerDuringSubmission(false);
          showSection(9);
        });
      }

      function nextWeekDateText() {
        const d = new Date();
        d.setDate(d.getDate() + 7);
        return d.toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" });
      }

      async function generateDocx() {
        const ready = await ensureDocxLibrary();
        if (!ready || !window.docx) {
          alert("DOCX library failed to load. Check internet connection for CDN access.");
          return;
        }

        const { Document, Packer, Paragraph, TextRun, AlignmentType, BorderStyle } = window.docx;
        const p = state.personal;
        const summaryText = (state.summary || "").trim();
        const softSkillsAll = [...state.softSkills, ...(state.customSoftSkill.trim() ? [state.customSoftSkill.trim()] : [])];
        const bodyLineSpacing = 276;
        const bodyAfter = 80;

        const children = [];

        const bodyParagraph = (text, options = {}) => new Paragraph({
          children: [new TextRun({
            text: text || "",
            font: "Calibri",
            size: 21,
            color: "1A1A2E",
            ...(options.run || {})
          })],
          spacing: { line: bodyLineSpacing, after: bodyAfter, ...(options.spacing || {}) },
          alignment: options.alignment || AlignmentType.LEFT,
          ...(options.extra || {})
        });

        const addSectionHeading = (text) => {
          children.push(new Paragraph({
            children: [new TextRun({
              text: String(text || "").toUpperCase(),
              font: "Calibri",
              size: 18,
              bold: true,
              color: "E8560A"
            })],
            border: {
              bottom: { color: "DDDDDD", style: BorderStyle.SINGLE, size: 4, space: 1 }
            },
            spacing: { before: 280, after: 120 }
          }));
        };

        const addBodyLine = (text, runOverrides = {}, spacingOverrides = {}) => {
          children.push(new Paragraph({
            children: [new TextRun({
              text,
              font: "Calibri",
              size: 21,
              color: "1A1A2E",
              ...runOverrides
            })],
            spacing: { line: bodyLineSpacing, after: bodyAfter, ...spacingOverrides }
          }));
        };

        const headerLine2Parts = [
          p.specialisation || "Specialisation",
          state.unitId || "UNIT-UNKNOWN",
          p.email || "Email"
        ];
        if ((p.linkedin || "").trim()) {
          headerLine2Parts.push(p.linkedin.trim());
        }

        children.push(new Paragraph({
          children: [new TextRun({
            text: (p.fullName || "Candidate Name").trim(),
            font: "Calibri",
            size: 44,
            bold: true,
            color: "1A1A2E"
          })],
          spacing: { after: 80 }
        }));

        children.push(new Paragraph({
          children: [new TextRun({
            text: headerLine2Parts.join(" | "),
            font: "Calibri",
            size: 18,
            color: "555555"
          })],
          spacing: { after: 40 }
        }));

        children.push(new Paragraph({
          border: {
            bottom: { color: "E8560A", style: BorderStyle.SINGLE, size: 8, space: 1 }
          },
          spacing: { after: 200 }
        }));

        if (summaryText) {
          addSectionHeading("PROFILE STATEMENT");
          addBodyLine(summaryText);
        }

        addSectionHeading("EDUCATION");
        const educationEntries = state.education.filter((entry) => (entry.institution || "").trim() || (entry.degree || "").trim());
        if (!educationEntries.length) {
          addBodyLine("N/A");
        } else {
          educationEntries.forEach((entry) => {
            const degree = (entry.degree || "Degree Title").trim();
            const institution = (entry.institution || "Institution").trim();
            children.push(new Paragraph({
              children: [new TextRun({
                text: `${degree} â€” ${institution}`,
                bold: true,
                font: "Calibri",
                size: 21,
                color: "1A1A2E"
              })],
              spacing: { line: bodyLineSpacing, after: 20 }
            }));

            const start = (entry.startYear || "").trim();
            const end = entry.present ? "Present" : (entry.endYear || "").trim();
            const years = [start, end].filter(Boolean).join(" â€“ ") || "Dates not specified";
            const gradeSuffix = (entry.grade || "").trim() ? ` [${entry.grade.trim()}]` : "";
            addBodyLine(`${years}${gradeSuffix}`, {}, { after: 20 });

            if (entry.modules && entry.modules.length) {
              addBodyLine(entry.modules.join(", "), { italics: true, size: 19, color: "666666" }, { after: 160 });
            } else {
              addBodyLine("", {}, { after: 160 });
            }
          });
        }

        addSectionHeading("ACADEMIC PROJECTS & FIELD EXPERIENCE");
        const projectEntries = state.projects.filter((project) => (project.title || "").trim() || (project.role || "").trim() || (project.period || "").trim());
        if (!projectEntries.length) {
          addBodyLine("N/A");
        } else {
          projectEntries.forEach((project) => {
            const title = (project.title || "Project").trim();
            const role = (project.role || "").trim();
            children.push(new Paragraph({
              children: [
                new TextRun({ text: title, bold: true, font: "Calibri", size: 21, color: "1A1A2E" }),
                ...(role ? [new TextRun({ text: ` Â· ${role}`, font: "Calibri", size: 21, color: "1A1A2E" })] : [])
              ],
              spacing: { line: bodyLineSpacing, after: 20 }
            }));

            const period = (project.period || "").trim();
            if (period) {
              addBodyLine(period, { italics: true, size: 19, color: "666666" }, { after: 20 });
            }

            const bulletText = getProjectBulletForOutput(project);
            if (bulletText) {
              children.push(new Paragraph({
                children: [new TextRun({ text: bulletText, font: "Calibri", size: 21, color: "1A1A2E" })],
                bullet: { level: 0 },
                spacing: { line: bodyLineSpacing, after: 20 }
              }));
            }

            if (project.tools && project.tools.length) {
              addBodyLine(`Tools used: ${project.tools.join(", ")}`, { italics: true, size: 19, color: "666666" }, { after: 160 });
            } else {
              addBodyLine("", {}, { after: 160 });
            }
          });
        }

        addSectionHeading("TECHNICAL SKILLS");
        const selectedSkills = (state.technicalSkills || []).map((skill) => (skill || "").trim()).filter(Boolean);
        if (!selectedSkills.length) {
          addBodyLine("N/A");
        } else {
          const groupLabels = {
            "GEOSPATIAL SOFTWARE": "Geospatial Software",
            PROGRAMMING: "Programming",
            "FIELD EQUIPMENT": "Field Equipment",
            "DATA & REPORTING": "Data & Reporting"
          };

          const groupedLines = [];
          const usedSkills = new Set();
          Object.entries(SKILL_GROUPS).forEach(([groupKey, groupSkills]) => {
            const present = selectedSkills.filter((skill) => groupSkills.includes(skill));
            if (!present.length) return;
            present.forEach((skill) => usedSkills.add(skill));
            groupedLines.push({
              label: groupLabels[groupKey] || groupKey,
              skills: present
            });
          });

          if (groupedLines.length) {
            groupedLines.forEach((row) => {
              children.push(new Paragraph({
                children: [
                  new TextRun({ text: `${row.label}: `, bold: true, font: "Calibri", size: 21, color: "1A1A2E" }),
                  new TextRun({ text: row.skills.join(" Â· "), font: "Calibri", size: 21, color: "1A1A2E" })
                ],
                spacing: { line: bodyLineSpacing, after: bodyAfter }
              }));
            });

            const extras = selectedSkills.filter((skill) => !usedSkills.has(skill));
            if (extras.length) {
              children.push(new Paragraph({
                children: [
                  new TextRun({ text: "Additional Skills: ", bold: true, font: "Calibri", size: 21, color: "1A1A2E" }),
                  new TextRun({ text: extras.join(" Â· "), font: "Calibri", size: 21, color: "1A1A2E" })
                ],
                spacing: { line: bodyLineSpacing, after: bodyAfter }
              }));
            }
          } else {
            for (let i = 0; i < selectedSkills.length; i += 4) {
              const row = selectedSkills.slice(i, i + 4);
              addBodyLine(row.join(" Â· "));
            }
          }
        }

        addSectionHeading("LANGUAGES");
        const languages = state.languages.filter((lang) => (lang.language || "").trim());
        if (!languages.length) {
          addBodyLine("N/A");
        } else {
          languages.forEach((lang) => {
            addBodyLine(`${lang.language.trim()}  â€”  ${(lang.level || "").trim() || "-"}`);
          });
        }

        addSectionHeading("SOFT SKILLS");
        addBodyLine(softSkillsAll.length ? softSkillsAll.join(", ") : "N/A");

        children.push(new Paragraph({
          children: [new TextRun({
            text: "Submitted via MARS-1 Career Portal â€” Recruitment Cycle 2031-B",
            font: "Calibri",
            size: 16,
            italics: true,
            color: "AAAAAA"
          })],
          alignment: AlignmentType.CENTER,
          spacing: { before: 220, after: 0 }
        }));

        const doc = new Document({
          styles: {
            default: {
              document: {
                run: {
                  font: "Calibri",
                  size: 21,
                  color: "1A1A2E"
                }
              }
            }
          },
          sections: [{
            properties: {
              page: {
                margin: {
                  top: 1021,
                  bottom: 1021,
                  left: 1134,
                  right: 1134
                }
              }
            },
            children
          }]
        });

        function buildExportFileName(fullName) {
          const parts = (fullName || "").trim().split(/\s+/).filter(Boolean);
          if (parts.length < 2) return "MARS1_Application.docx";
          const firstName = parts[0];
          const lastName = parts[parts.length - 1];
          const safe = (value) => value.replace(/\s+/g, "_").replace(/[^A-Za-z0-9_-]/g, "");
          const safeFirst = safe(firstName);
          const safeLast = safe(lastName);
          if (!safeFirst || !safeLast) return "MARS1_Application.docx";
          return `MARS1_${safeLast}_${safeFirst}.docx`;
        }

        Packer.toBlob(doc).then((blob) => {
          const fileName = buildExportFileName(p.fullName);
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }).catch((err) => {
          console.error(err);
          alert("Unable to generate DOCX file.");
        });
      }

      function initIntroAction() {
        document.getElementById("accessPortalBtn").addEventListener("click", () => {
          clearInterval(introCountdownInterval);
          startApp();
        });
      }

      function startIntroCountdown() {
        const introEl = document.getElementById("introCountdown");
        const introStart = Date.now();
        clearInterval(introCountdownInterval);
        const tick = () => {
          const elapsed = Math.floor((Date.now() - introStart) / 1000);
          const remaining = Math.max(0, TOTAL_SECONDS - elapsed);
          const mm = String(Math.floor(remaining / 60)).padStart(2, "0");
          const ss = String(remaining % 60).padStart(2, "0");
          introEl.textContent = `${mm}:${ss}`;
          if (remaining <= 0) clearInterval(introCountdownInterval);
        };
        tick();
        introCountdownInterval = setInterval(tick, 1000);
      }

      function initDataLists() {
        const dl = document.createElement("datalist");
        dl.id = "languageSuggestions";
        ["English", "Spanish", "French", "German", "Italian", "Portuguese", "Arabic", "Russian", "Ukrainian", "Chinese", "Japanese", "Other"].forEach((l) => {
          const opt = document.createElement("option");
          opt.value = l;
          dl.appendChild(opt);
        });
        document.body.appendChild(dl);
      }

      function initGlobalAutosave() {
        document.body.addEventListener("input", () => {
          saveState();
        });
      }

      function init() {
        loadState();
        currentStep = Math.min(10, Math.max(2, Number(state.currentStep) || 2));
        ensureUnitId();
        buildStepper();
        wirePersonalFields();
        wireSummary();

        if (!state.education.length) addEducationEntry();
        else renderEducation();

        if (!state.projects.length) addProjectEntry();
        else renderProjects();

        renderSkillsMatrix();
        renderSelectedSkills();
        renderLanguages();
        renderSoftSkills();
        restoreInputsFromState();
        wireButtonsAndDynamicAdds();
        setupNavigation();
        initIntroAction();
        initDataLists();
        initGlobalAutosave();
        typewriterIntro();
        startIntroCountdown();
        ensureDocxLibrary();
        initMarsSatelliteOrbit();

        updateCompleteness();
        renderPreview();

        if (state.appStarted) {
          startApp();
        }
      }

      init();
    })();
  </script>
</body>
</html>
